<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Interfaces &mdash; Wordish v1.0.0 documentation</title>
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '1.0.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Wordish v1.0.0 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li><a href="index.html">Wordish v1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Interfaces</a><ul>
<li><a class="reference external" href="#module-interfaces">Overview</a></li>
<li><a class="reference external" href="#id2">Interfaces</a></li>
</ul>
</li>
</ul>

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="sources/interfaces.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="interfaces">
<span id="id1"></span><h1>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-interfaces">
<h2>Overview<a class="headerlink" href="#module-interfaces" title="Permalink to this headline">¶</a></h2>
<p>The <em>Wordish</em> modules declares three central classes:</p>
<ul class="simple">
<li>the <a title="interfaces.BlockFilter" class="reference internal" href="#interfaces.BlockFilter"><tt class="xref docutils literal"><span class="pre">BlockFilter</span></tt></a> which, given a directive, filters
restructured blocks of text marked with the <em>directive</em> attribute of
the object,</li>
<li>the <a title="interfaces.ShellSessionParser" class="reference internal" href="#interfaces.ShellSessionParser"><tt class="xref docutils literal"><span class="pre">ShellSessionParser</span></tt></a> which splits a shell session log into
commands and outputs,</li>
<li>and the <a title="interfaces.CommandRunner" class="reference internal" href="#interfaces.CommandRunner"><tt class="xref docutils literal"><span class="pre">CommandRunner</span></tt></a> which spawns a shell subprocess, and
to which the parsed commands are sent for execution,</li>
</ul>
<p>The <tt class="xref docutils literal"><span class="pre">wordish()</span></tt> module function, which is the main entry point of
the script, requires a file descriptor <em>f</em> argument containing a shell
session in a restructured text article. A simplified version of
<tt class="xref docutils literal"><span class="pre">wordish()</span></tt> boils down to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">filter</span> <span class="o">=</span> <span class="n">BlockFilter</span><span class="p">(</span> <span class="n">directive</span><span class="o">=</span><span class="s">&#39;sourcecode&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;sh&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="k">with</span> <span class="n">CommandRunner</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">ShellSessionParser</span><span class="p">(</span> <span class="nb">filter</span><span class="p">(</span> <span class="n">f</span> <span class="p">)</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">run</span><span class="p">(</span> <span class="n">cmd</span> <span class="p">)</span> <span class="o">!=</span> <span class="n">expected</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Warning: unexpected command </span><span class="si">%s</span><span class="s"> &#39;s output&quot;</span>
</pre></div>
</div>
<p><em>Wordish</em> also declares two additional classes:</p>
<ul>
<li><p class="first">The <a title="interfaces.Reporter" class="reference internal" href="#interfaces.Reporter"><tt class="xref docutils literal"><span class="pre">Reporter</span></tt></a> formats the parsed commands and output,
accumulates the success and failures, and formats a report in the
end.</p>
</li>
<li><p class="first">The <a title="interfaces.CommandOutput" class="reference internal" href="#interfaces.CommandOutput"><tt class="xref docutils literal"><span class="pre">CommandOutput</span></tt></a> is used to model the ouput of a shell
command: the message printed on stdout, the message printed on
stderr, and the return code. The <tt class="xref docutils literal"><span class="pre">CommandRunner.__call__()</span></tt>
method returns instances of this class.</p>
<p>A <em>CommandOutput</em> can be compared to a simple string, with the
<tt class="docutils literal"><span class="pre">==</span></tt> or <tt class="docutils literal"><span class="pre">!=</span></tt> syntax (as in the example above), in which case,
only the stdout message is used for the comparison.</p>
</li>
</ul>
<p>The <tt class="xref docutils literal"><span class="pre">wordish()</span></tt> module function articulates the five classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">report</span> <span class="o">=</span> <span class="n">TestReporter</span><span class="p">()</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="n">BlockFilter</span><span class="p">(</span><span class="n">directive</span><span class="o">=</span><span class="s">&#39;sourcecode&#39;</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;sh&#39;</span><span class="p">])</span>

<span class="k">with</span> <span class="n">CommandRunner</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="n">ShellSessionParser</span><span class="p">(</span> <span class="nb">filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">):</span>
        <span class="k">print</span> <span class="n">report</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="k">print</span> <span class="n">report</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="n">expected</span> <span class="k">else</span> <span class="n">report</span><span class="o">.</span><span class="n">failure</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">aborted</span><span class="p">():</span> 
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;there was a serious error: bailing out&quot;</span><span class="p">)</span>
            <span class="k">break</span>
</pre></div>
</div>
<p><em>Wordish</em> makes use of five python modules from the standard library:</p>
<ul class="simple">
<li><a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/library/shlex.html#module-shlex"><tt class="xref docutils literal"><span class="pre">shlex</span></tt></a> parses text,</li>
<li><a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/library/itertools.html#module-itertools"><tt class="xref docutils literal"><span class="pre">itertools</span></tt></a> provides <tt class="xref docutils literal"><span class="pre">takewhile()</span></tt> functions and others
functional tools,</li>
<li><a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/library/stringio.html#module-StringIO"><tt class="xref docutils literal"><span class="pre">StringIO</span></tt></a> adapts a character string to the interface of an
open file.</li>
<li><a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/library/re.html#module-re"><tt class="xref docutils literal"><span class="pre">re</span></tt></a> is the regular expression module,</li>
<li><a title="(in Python v2.6)" class="reference external" href="http://docs.python.org/library/sys.html#module-sys"><tt class="xref docutils literal"><span class="pre">sys</span></tt></a>, among others, gives access to the command line
arguments, and the exit status.</li>
</ul>
<p>Also, the required additional module, <tt class="xref docutils literal"><span class="pre">docutils</span></tt> offers the tools
to filter text in the <em>restructured text</em> format.</p>
</div>
<div class="section" id="id2">
<h2>Interfaces<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="interfaces.ShellSessionParser">
<em class="property">class </em><tt class="descclassname">interfaces.</tt><tt class="descname">ShellSessionParser</tt><a class="headerlink" href="#interfaces.ShellSessionParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Created with an open file <em>f</em>, containing a shell text
<em>session</em>, and optionally, <em>prompts</em>, the list of potential
prompts in the session.</p>
<p>A <em>session</em> begins with a prompt, then a <em>command</em> follows
until a newline, except when the newline is nested in curly
brackets or parentheses. Then follows the output which ends with a
newline and a prompt.</p>
<p>This object is an iterable, and can be called in a for loop or a
generator expression: the next() method yields lists of two
strings: a command and an output.</p>
<p>The parsed commands can be sent to a <em>ICommandRunner</em> and the
parsed output can be compared to the CommandOutput instance
returned by the <em>ICommandRunner</em></p>
<p>Also, The SessionParser is instantiated twice in the command
runner, connected to the stdout and stderr files of the shell
subprocess.</p>
<dl class="method">
<dt id="interfaces.ShellSessionParser.next">
<tt class="descname">next</tt><big>(</big><big>)</big><a class="headerlink" href="#interfaces.ShellSessionParser.next" title="Permalink to this definition">¶</a></dt>
<dd>Returns a tuple whose first element is a command, and second
element is an output.</dd></dl>

<dl class="method">
<dt id="interfaces.ShellSessionParser.takewhile">
<tt class="descname">takewhile</tt><big>(</big><em>is_output</em><big>)</big><a class="headerlink" href="#interfaces.ShellSessionParser.takewhile" title="Permalink to this definition">¶</a></dt>
<dd>Returns a string composed of the tokens until a specific
token: either an un-nested linefeed if the argument <em>is_output</em>
is false, or a prompt if <em>is_output</em> is true.</dd></dl>

</dd></dl>

<dl class="class">
<dt id="interfaces.CommandRunner">
<em class="property">class </em><tt class="descclassname">interfaces.</tt><tt class="descname">CommandRunner</tt><a class="headerlink" href="#interfaces.CommandRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>The CommandRunner is a context manager which runs a shell created
only for the duration of a <em>with</em> python code block. A context
manager is an object which can be called from a with statement.</p>
<p><strong>The instance is a callable</strong>, which takes, as first argument, a
shell command to be executed, the stdin, stdout and returncode of
the command is returned as an <em>OutputCommand</em>.</p>
<p>On <strong>entering the context</strong>, setup the ressource (the shell) executing
the commands. On <strong>exiting the context</strong>, terminate the shell.</p>
</dd></dl>

<dl class="class">
<dt id="interfaces.CommandOutput">
<em class="property">class </em><tt class="descclassname">interfaces.</tt><tt class="descname">CommandOutput</tt><a class="headerlink" href="#interfaces.CommandOutput" title="Permalink to this definition">¶</a></dt>
<dd><p>Structures the output of a standard shell command with the two
strings read on stdout and stderr plus the returncode.</p>
<p>The <strong>equality operator</strong> can be used with the CommandOutput, The
equality operator expects either a string or a CommandOuput as a
right hand side. The right hand side can contain the three dots
pattern &#8216;...&#8217; to match anything.</p>
<p>When matching against another CommandOutput, only the non null
attributes are matched: output == CommandOutput(out=None,
err=None, returncode=None) is always True.</p>
<dl class="attribute">
<dt id="interfaces.CommandOutput.err">
<tt class="descname">err</tt><a class="headerlink" href="#interfaces.CommandOutput.err" title="Permalink to this definition">¶</a></dt>
<dd>The standard error channel</dd></dl>

<dl class="attribute">
<dt id="interfaces.CommandOutput.out">
<tt class="descname">out</tt><a class="headerlink" href="#interfaces.CommandOutput.out" title="Permalink to this definition">¶</a></dt>
<dd>The standard output channel</dd></dl>

<dl class="attribute">
<dt id="interfaces.CommandOutput.returncode">
<tt class="descname">returncode</tt><a class="headerlink" href="#interfaces.CommandOutput.returncode" title="Permalink to this definition">¶</a></dt>
<dd>The return code</dd></dl>

</dd></dl>

<dl class="class">
<dt id="interfaces.Reporter">
<em class="property">class </em><tt class="descclassname">interfaces.</tt><tt class="descname">Reporter</tt><a class="headerlink" href="#interfaces.Reporter" title="Permalink to this definition">¶</a></dt>
<dd><p>The Reporter methods are introduced between the calls to the
SessionParser and the CommandRunner</p>
<dl class="method">
<dt id="interfaces.Reporter.before">
<tt class="descname">before</tt><big>(</big><em>cmd</em><big>)</big><a class="headerlink" href="#interfaces.Reporter.before" title="Permalink to this definition">¶</a></dt>
<dd>Annonce the action to come. For example, the test to be
done, the expected result. In case, the test takes time, it is
desirable to let the user know what is happening beforehand.</dd></dl>

<dl class="method">
<dt id="interfaces.Reporter.failed">
<tt class="descname">failed</tt><big>(</big><em>output</em><big>)</big><a class="headerlink" href="#interfaces.Reporter.failed" title="Permalink to this definition">¶</a></dt>
<dd>Formats a failed result. Decrement the <em>passed</em> counter</dd></dl>

<dl class="method">
<dt id="interfaces.Reporter.passed">
<tt class="descname">passed</tt><big>(</big><em>output</em><big>)</big><a class="headerlink" href="#interfaces.Reporter.passed" title="Permalink to this definition">¶</a></dt>
<dd>Formats a successful result. Increment the <em>passed</em> counter</dd></dl>

<dl class="method">
<dt id="interfaces.Reporter.summary">
<tt class="descname">summary</tt><big>(</big><big>)</big><a class="headerlink" href="#interfaces.Reporter.summary" title="Permalink to this definition">¶</a></dt>
<dd>Report the operations with, the number of actions, the
number of success, the number of failure, etc.</dd></dl>

</dd></dl>

<dl class="class">
<dt id="interfaces.BlockFilter">
<em class="property">class </em><tt class="descclassname">interfaces.</tt><tt class="descname">BlockFilter</tt><a class="headerlink" href="#interfaces.BlockFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Given an open file on a restructured text document, returns an
open file containing the text blocks marked up by the directive
attribute.</p>
<dl class="attribute">
<dt id="interfaces.BlockFilter.arguments">
<tt class="descname">arguments</tt><a class="headerlink" href="#interfaces.BlockFilter.arguments" title="Permalink to this definition">¶</a></dt>
<dd>A list of arguments</dd></dl>

<dl class="attribute">
<dt id="interfaces.BlockFilter.directive">
<tt class="descname">directive</tt><a class="headerlink" href="#interfaces.BlockFilter.directive" title="Permalink to this definition">¶</a></dt>
<dd>Only text marked up with this directive will be kept</dd></dl>

<dl class="attribute">
<dt id="interfaces.BlockFilter.options">
<tt class="descname">options</tt><a class="headerlink" href="#interfaces.BlockFilter.options" title="Permalink to this definition">¶</a></dt>
<dd>A dictionary of options:values</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Wordish v1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Jean Daniel Browne.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.4.
    </div>
  </body>
</html>